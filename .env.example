# Core
NODE_ENV=development
IDENTIFIER_HASH_SECRET=change_me_identifier_hash_secret

# Redis
REDIS_URL=redis://redis:6379/0
# Redis encryption (32 bytes = 64 hex characters)
# Generate with: openssl rand -hex 32
REDIS_ENCRYPTION_KEY=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
REDIS_ENCRYPTION_ENABLED=true

# PostgreSQL
POSTGRES_PASSWORD=change_me_to_a_secure_password
DATABASE_URL=postgres://postgres:change_me_to_a_secure_password@postgres:5432/wbscanner

# Service-specific database credentials (least privilege)
DB_ADMIN_URL=postgres://postgres:change_me_to_a_secure_password@postgres:5432/wbscanner
DB_CONTROL_PLANE_PASSWORD=change_me_control_plane_password
DB_SCAN_ORCHESTRATOR_PASSWORD=change_me_scan_orchestrator_password
DB_WA_CLIENT_PASSWORD=change_me_wa_client_password
DB_CONTROL_PLANE_URL=postgres://control_plane_role:change_me_control_plane_password@postgres:5432/wbscanner
DB_SCAN_ORCHESTRATOR_URL=postgres://scan_orchestrator_role:change_me_scan_orchestrator_password@postgres:5432/wbscanner
DB_WA_CLIENT_URL=postgres://wa_client_role:change_me_wa_client_password@postgres:5432/wbscanner

# SQLite (replaces PostgreSQL)
SQLITE_DB_PATH=./storage/wbscanner.db

# Queues
SCAN_REQUEST_QUEUE=scan-request
SCAN_VERDICT_QUEUE=scan-verdict
SCAN_URLSCAN_QUEUE=scan-urlscan
WA_HEALTH_QUEUE=wa-health

# Orchestrator
SCAN_CONCURRENCY=10
URL_EXPANSION_MAX_REDIRECTS=5
URL_EXPANSION_TIMEOUT_MS=5000
URL_MAX_CONTENT_LENGTH=1048576
CACHE_TTL_BENIGN_SECONDS=86400
CACHE_TTL_SUSPICIOUS_SECONDS=3600
CACHE_TTL_MALICIOUS_SECONDS=900

# VirusTotal
VT_API_KEY=
VT_REQUEST_TIMEOUT_MS=8000
# Token bucket limiter for the community tier. Raise after purchasing a higher quota.
VT_REQUESTS_PER_MINUTE=4
# Random delay (milliseconds) injected ahead of each request to avoid synchronized bursts.
VT_REQUEST_JITTER_MS=500

# Google Safe Browsing
GSB_API_KEY=
GSB_REQUEST_TIMEOUT_MS=5000
GSB_FALLBACK_LATENCY_MS=500

# RDAP / WHOIS
RDAP_TIMEOUT_MS=5000

# Self-hosted Who-dat WHOIS service (recommended, no quota limits)
WHODAT_ENABLED=true
WHODAT_BASE_URL=http://who-dat:8080
WHODAT_TIMEOUT_MS=5000

# WhoisXML API (fallback, has quota limits)
WHOISXML_ENABLE=false
WHOISXML_API_KEY=
WHOISXML_TIMEOUT_MS=5000
WHOISXML_MONTHLY_QUOTA=500
WHOISXML_QUOTA_ALERT_THRESHOLD=100

# URLhaus
URLHAUS_ENABLED=true
URLHAUS_TIMEOUT_MS=5000

# Phishtank
PHISHTANK_ENABLED=true
PHISHTANK_APP_KEY=
PHISHTANK_USER_AGENT=wbscanner-bot/1.0
PHISHTANK_TIMEOUT_MS=5000

# urlscan.io
URLSCAN_ENABLED=true
URLSCAN_API_KEY=
URLSCAN_BASE_URL=https://urlscan.io
URLSCAN_VISIBILITY=private
URLSCAN_TAGS=wbscanner
URLSCAN_CALLBACK_URL=
URLSCAN_CALLBACK_SECRET=
URLSCAN_SUBMIT_TIMEOUT_MS=10000
URLSCAN_RESULT_TIMEOUT_MS=30000
URLSCAN_UUID_TTL_SECONDS=86400
URLSCAN_RESULT_TTL_SECONDS=86400
URLSCAN_CONCURRENCY=2

# Shortener expansion
UNSHORTEN_ENDPOINT=https://unshorten.me/json/
UNSHORTEN_RETRIES=1
SHORTENER_CACHE_TTL_SECONDS=86400

# Feature Flags
FEATURE_ATTACH_MEDIA_VERDICTS=false

# Enhanced Security Features
ENHANCED_SECURITY_ENABLED=true
DNSBL_ENABLED=true
DNSBL_TIMEOUT_MS=2000
CERT_INTEL_ENABLED=true
CERT_INTEL_TIMEOUT_MS=3000
CERT_INTEL_CT_CHECK_ENABLED=true
LOCAL_THREAT_DB_ENABLED=true
OPENPHISH_FEED_URL=https://openphish.com/feed.txt
OPENPHISH_UPDATE_INTERVAL_MS=7200000
HTTP_FINGERPRINT_ENABLED=true
HTTP_FINGERPRINT_TIMEOUT_MS=2000
ENHANCED_HEURISTICS_ENTROPY_THRESHOLD=4.5

# LLM (optional)
LLM_ENABLED=false
OPENAI_API_KEY=

# WA Client
# WhatsApp Library Selection
# Options: baileys (recommended, protocol-based, ~50MB RAM)
#          wwebjs (legacy, browser-based, ~500MB RAM)
WA_LIBRARY=baileys
# Docker build target (set automatically based on WA_LIBRARY choice)
# wa-client-baileys = lightweight (~100MB), wa-client = with Puppeteer (~800MB)
WA_BUILD_TARGET=wa-client-baileys

WA_AUTH_STRATEGY=remote
WA_REMOTE_AUTH_STORE=redis
WA_AUTH_CLIENT_ID=default
# Base64-encoded 32-byte key; setup.sh will populate automatically.
WA_REMOTE_AUTH_DATA_KEY=
# WA_REMOTE_AUTH_ENCRYPTED_DATA_KEY=
# WA_REMOTE_AUTH_KMS_KEY_ID=
# WA_REMOTE_AUTH_VAULT_PATH=
# WA_REMOTE_AUTH_VAULT_TOKEN=
# WA_REMOTE_AUTH_VAULT_ADDRESS=
WA_REMOTE_AUTH_BACKUP_INTERVAL_MS=300000
WA_REMOTE_AUTH_DATA_PATH=./data/remote-session
# Remote Auth / Phone Pairing (Multi-Number Support)
# Comma-separated list of phone numbers (digits only), e.g., "12025550123,12025550124,12025550125"
# The system will check all numbers in parallel when requesting pairing codes.
WA_REMOTE_AUTH_PHONE_NUMBERS=

# DEPRECATED: Use WA_REMOTE_AUTH_PHONE_NUMBERS instead (kept for backwards compatibility)
# WA_REMOTE_AUTH_PHONE_NUMBER=

# On-Demand Polling Configuration
# Enable scheduled background polling for pairing codes (default: false)
# WARNING: Enable only if you understand the rate limiting risks
WA_REMOTE_AUTH_POLLING_ENABLED=false

# How often to check for new pairing codes (in minutes, minimum 5)
WA_REMOTE_AUTH_POLLING_INTERVAL_MINUTES=10

# Maximum duration to poll for per day (in minutes)
WA_REMOTE_AUTH_POLLING_DURATION_MINUTES=60

# Optional: Time window for polling (24-hour format), e.g., "09:00-17:00"
# Leave empty to poll all day (if polling is enabled)
WA_REMOTE_AUTH_POLLING_SCHEDULE=

# Timeout for parallel number checking (milliseconds)
WA_REMOTE_AUTH_PARALLEL_TIMEOUT_MS=30000

# Automatic background pairing is DISABLED by default to prevent rate limiting.
# Use admin command !scanner pair or HTTP endpoint /pair to manually request pairing codes.
WA_REMOTE_AUTH_AUTO_PAIR=false
# WA_REMOTE_AUTH_AUTO_PAIR_DELAY_MS=120000
WA_REMOTE_AUTH_RETRY_DELAY_MS=15000
WA_REMOTE_AUTH_MAX_RETRIES=5
WA_REMOTE_AUTH_DISABLE_QR_FALLBACK=false
WA_REMOTE_AUTH_FORCE_NEW_SESSION=false
WA_HEADLESS=true
WA_PUPPETEER_ARGS=--no-sandbox,--disable-setuid-sandbox,--disable-dev-shm-usage
WA_QR_TERMINAL=true
WA_CONSENT_ON_JOIN=true
WA_AUTO_APPROVE_DEFAULT=true
WA_AUTO_APPROVE_RATE_PER_HOUR=20
WA_GOVERNANCE_ACTIONS_PER_HOUR=12
WA_VERDICT_ACK_TIMEOUT_SECONDS=15
WA_VERDICT_ACK_MAX_RETRIES=2
WA_QUIET_HOURS=22-07
WA_PER_GROUP_REPLY_COOLDOWN_SECONDS=60
# Global token bucket: messages per hour across all groups
WA_GLOBAL_REPLY_RATE_PER_HOUR=1000
# Redis key prefix for the global token bucket state
WA_GLOBAL_TOKEN_BUCKET_KEY=wa_global_token_bucket
# Per-group hourly limit for verdict replies
WA_PER_GROUP_HOURLY_LIMIT=60
WA_ALERT_WEBHOOK_URL=
WA_VERDICT_MEDIA_DIR=

# Control Plane (API token is required; generate a strong random string)
CONTROL_PLANE_PORT=8080
CONTROL_PLANE_API_TOKEN=change-me
CONTROL_PLANE_ENABLE_UI=true
CONTROL_PLANE_BASE=http://control-plane:8080

# SafeMode Web App
SAFEMODE_ADMIN_TOKEN=change-me
SAFEMODE_SESSION_SECRET=

# Reverse Proxy
REVERSE_PROXY_PORT=8088
REVERSE_PROXY_ALLOWED_IPS=0.0.0.0/0

# Observability
METRICS_PORT=9090
PROMETHEUS_SCRAPE_INTERVAL=5s

# Scan Orchestrator API (exposed for health checks and debugging)
SCAN_ORCHESTRATOR_PORT=3003

# Grafana (metrics dashboard)
# Access at http://localhost:3002 with admin/admin
GRAFANA_PORT=3002

# Uptime Kuma (GUI monitoring dashboard)
# Access at http://localhost:3001 after running `make up`
# Default admin credentials should be set on first login
UPTIME_KUMA_PORT=3001

# DeepSource API (optional - for programmatic code analysis access)
# Generate token at: https://app.deepsource.com/settings/tokens
DEEPSOURCE_API_TOKEN=
DEEPSOURCE_REPO_OWNER=ElliotBadinger
DEEPSOURCE_REPO_NAME=whatsapp-bot-scanner
