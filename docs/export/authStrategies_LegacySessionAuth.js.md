whatsapp-web.js 1.23.0 &raquo; Source: authStrategies/LegacySessionAuth.js

        [whatsapp-web.js 1.23.0](index.html)

            # Source: authStrategies/LegacySessionAuth.js

            ```
&#x27;use strict&#x27;;

const BaseAuthStrategy &#x3D; require(&#x27;./BaseAuthStrategy&#x27;);

/**
 * Legacy session auth strategy
 * Not compatible with multi-device accounts.
 * @param {object} options - options
 * @param {string} options.restartOnAuthFail - Restart client with a new session (i.e. use null &#x27;session&#x27; var) if authentication fails
 * @param {object} options.session - Whatsapp session to restore. If not set, will start a new session
 * @param {string} options.session.WABrowserId
 * @param {string} options.session.WASecretBundle
 * @param {string} options.session.WAToken1
 * @param {string} options.session.WAToken2
 */
class LegacySessionAuth extends BaseAuthStrategy {
    constructor({ session, restartOnAuthFail }&#x3D;{}) {
        super();
        this.session &#x3D; session;
        this.restartOnAuthFail &#x3D; restartOnAuthFail;
    }

    async afterBrowserInitialized() {
        if(this.session) {
            await this.client.pupPage.evaluateOnNewDocument(session &#x3D;> {
                if (document.referrer &#x3D;&#x3D;&#x3D; &#x27;https://whatsapp.com/&#x27;) {
                    localStorage.clear();
                    localStorage.setItem(&#x27;WABrowserId&#x27;, session.WABrowserId);
                    localStorage.setItem(&#x27;WASecretBundle&#x27;, session.WASecretBundle);
                    localStorage.setItem(&#x27;WAToken1&#x27;, session.WAToken1);
                    localStorage.setItem(&#x27;WAToken2&#x27;, session.WAToken2);
                }
  
                localStorage.setItem(&#x27;remember-me&#x27;, &#x27;true&#x27;);
            }, this.session);
        }
    }

    async onAuthenticationNeeded() {
        if(this.session) {
            this.session &#x3D; null;
            return {
                failed: true,
                restart: this.restartOnAuthFail,
                failureEventPayload: &#x27;Unable to log in. Are the session details valid?&#x27;
            };
        }

        return { failed: false };
    }

    async getAuthEventPayload() {
        const isMD &#x3D; await this.client.pupPage.evaluate(() &#x3D;> {
            return window.Store.MDBackend;
        });

        if(isMD) throw new Error(&#x27;Authenticating via JSON session is not supported for MultiDevice-enabled WhatsApp accounts.&#x27;);

        const localStorage &#x3D; JSON.parse(await this.client.pupPage.evaluate(() &#x3D;> {
            return JSON.stringify(window.localStorage);
        }));

        return {
            WABrowserId: localStorage.WABrowserId,
            WASecretBundle: localStorage.WASecretBundle,
            WAToken1: localStorage.WAToken1,
            WAToken2: localStorage.WAToken2
        };
    }
}

module.exports &#x3D; LegacySessionAuth;

```

        Generated by [JSDoc](https://github.com/jsdoc3/jsdoc) 3.6.11 on October 21, 2023.