{
  "annotations": {
    "list": []
  },
  "editable": true,
  "schemaVersion": 39,
  "version": 1,
  "title": "WBScanner Operational",
  "panels": [
    {
      "type": "stat",
      "title": "Messages Ingested",
      "gridPos": {
        "x": 0,
        "y": 0,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "expr": "sum(increase(wbscanner_messages_ingested_total[5m]))"
        }
      ]
    },
    {
      "type": "gauge",
      "title": "Cache Hit Ratio",
      "gridPos": {
        "x": 6,
        "y": 0,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "expr": "sum(rate(wbscanner_cache_hits_total[5m]))/(sum(rate(wbscanner_cache_hits_total[5m]))+sum(rate(wbscanner_cache_misses_total[5m])))"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "mappings": []
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Scan Latency P95",
      "gridPos": {
        "x": 0,
        "y": 4,
        "w": 12,
        "h": 6
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(wbscanner_scan_latency_seconds_bucket[5m])) by (le))"
        }
      ]
    },
    {
      "type": "stat",
      "title": "VT Submissions",
      "gridPos": {
        "x": 0,
        "y": 10,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "expr": "sum(increase(wbscanner_vt_submissions_total[5m]))"
        }
      ]
    },
    {
      "type": "stat",
      "title": "GSB Hits",
      "gridPos": {
        "x": 6,
        "y": 10,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "expr": "sum(increase(wbscanner_gsb_hits_total[5m]))"
        }
      ]
    },
    {
      "type": "gauge",
      "title": "VT Quota Remaining",
      "gridPos": {
        "x": 0,
        "y": 14,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "expr": "wbscanner_api_quota_remaining{service=\"virustotal\"}"
        }
      ]
    },
    {
      "type": "gauge",
      "title": "WhoisXML Quota Remaining",
      "gridPos": {
        "x": 6,
        "y": 14,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "expr": "wbscanner_api_quota_remaining{service=\"whoisxml\"}"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Queue Depth",
      "gridPos": {
        "x": 0,
        "y": 18,
        "w": 12,
        "h": 6
      },
      "targets": [
        {
          "expr": "wbscanner_queue_depth"
        }
      ]
    },
    {
      "type": "stat",
      "title": "Shortener Fallback Errors",
      "gridPos": {
        "x": 0,
        "y": 24,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "expr": "sum(increase(wbscanner_shortener_expansions_total{method=\"url-expand\",result=\"error\"}[5m]))"
        }
      ]
    },
    {
      "type": "stat",
      "title": "Homoglyph Detections",
      "gridPos": {
        "x": 6,
        "y": 24,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "expr": "sum(increase(wbscanner_homoglyph_detections_total[5m]))"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Verdicts by Level",
      "gridPos": {
        "x": 0,
        "y": 28,
        "w": 12,
        "h": 6
      },
      "targets": [
        {
          "expr": "sum by(level) (increase(wbscanner_verdicts_total[5m]))"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "WA State Changes",
      "gridPos": {
        "x": 0,
        "y": 34,
        "w": 12,
        "h": 6
      },
      "targets": [
        {
          "expr": "sum by(event) (increase(wbscanner_wa_state_changes_total[5m]))"
        }
      ]
    },
    {
      "type": "stat",
      "title": "Verdict Failures (10m)",
      "gridPos": {
        "x": 0,
        "y": 40,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "expr": "sum(increase(wbscanner_wa_verdict_delivery_total{result=\"failed\"}[10m]))"
        }
      ]
    },
    {
      "type": "stat",
      "title": "Verdict Retries (10m)",
      "gridPos": {
        "x": 6,
        "y": 40,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "expr": "sum(increase(wbscanner_wa_verdict_delivery_retries_total[10m]))"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Verdict Delivery Outcomes",
      "gridPos": {
        "x": 0,
        "y": 44,
        "w": 12,
        "h": 6
      },
      "targets": [
        {
          "expr": "sum by(result) (increase(wbscanner_wa_verdict_delivery_total[5m]))"
        }
      ]
    }
  ]
}
