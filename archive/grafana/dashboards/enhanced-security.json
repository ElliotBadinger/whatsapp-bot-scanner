{
  "annotations": {
    "list": []
  },
  "editable": true,
  "schemaVersion": 39,
  "version": 1,
  "title": "WBScanner Enhanced Security",
  "uid": "enhanced-security",
  "tags": ["wbscanner", "security"],
  "timezone": "browser",
  "refresh": "10s",
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "panels": [
    {
      "type": "row",
      "title": "Overview",
      "gridPos": {
        "x": 0,
        "y": 0,
        "w": 24,
        "h": 1
      },
      "collapsed": false
    },
    {
      "type": "stat",
      "title": "Tier 1 Blocks (High Confidence)",
      "gridPos": {
        "x": 0,
        "y": 1,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "expr": "sum(increase(tier1_blocks_total[5m]))",
          "legendFormat": "Tier 1 Blocks"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "green"
              },
              {
                "value": 10,
                "color": "yellow"
              },
              {
                "value": 50,
                "color": "red"
              }
            ]
          }
        }
      }
    },
    {
      "type": "stat",
      "title": "API Calls Avoided",
      "gridPos": {
        "x": 6,
        "y": 1,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "expr": "sum(increase(api_calls_avoided_total[5m]))",
          "legendFormat": "API Calls Saved"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "blue"
              }
            ]
          }
        }
      }
    },
    {
      "type": "gauge",
      "title": "Enhanced Security Score (Avg)",
      "gridPos": {
        "x": 12,
        "y": 1,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(enhanced_security_score_bucket[5m])) by (le))",
          "legendFormat": "P95 Score"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "min": 0,
          "max": 3,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "green"
              },
              {
                "value": 1.5,
                "color": "yellow"
              },
              {
                "value": 2.0,
                "color": "red"
              }
            ]
          }
        }
      }
    },
    {
      "type": "stat",
      "title": "API Call Reduction Rate",
      "gridPos": {
        "x": 18,
        "y": 1,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "expr": "sum(rate(api_calls_avoided_total[5m])) / (sum(rate(api_calls_avoided_total[5m])) + sum(rate(wbscanner_external_api_calls_total[5m]))) * 100",
          "legendFormat": "Reduction %"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "red"
              },
              {
                "value": 20,
                "color": "yellow"
              },
              {
                "value": 30,
                "color": "green"
              }
            ]
          }
        }
      }
    },
    {
      "type": "row",
      "title": "Performance",
      "gridPos": {
        "x": 0,
        "y": 5,
        "w": 24,
        "h": 1
      },
      "collapsed": false
    },
    {
      "type": "timeseries",
      "title": "Enhanced Security Latency by Tier",
      "gridPos": {
        "x": 0,
        "y": 6,
        "w": 12,
        "h": 6
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum(rate(enhanced_security_latency_seconds_bucket{tier=\"tier1\"}[5m])) by (le))",
          "legendFormat": "Tier 1 P50"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(enhanced_security_latency_seconds_bucket{tier=\"tier1\"}[5m])) by (le))",
          "legendFormat": "Tier 1 P95"
        },
        {
          "expr": "histogram_quantile(0.50, sum(rate(enhanced_security_latency_seconds_bucket{tier=\"tier2\"}[5m])) by (le))",
          "legendFormat": "Tier 2 P50"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(enhanced_security_latency_seconds_bucket{tier=\"tier2\"}[5m])) by (le))",
          "legendFormat": "Tier 2 P95"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Enhanced Security Score Distribution",
      "gridPos": {
        "x": 12,
        "y": 6,
        "w": 12,
        "h": 6
      },
      "targets": [
        {
          "expr": "sum(rate(enhanced_security_score_bucket[5m])) by (le)",
          "legendFormat": "Score <= {{le}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "fillOpacity": 10
          }
        }
      }
    },
    {
      "type": "row",
      "title": "DNS Intelligence",
      "gridPos": {
        "x": 0,
        "y": 12,
        "w": 24,
        "h": 1
      },
      "collapsed": false
    },
    {
      "type": "timeseries",
      "title": "DNSBL Query Rate by Provider",
      "gridPos": {
        "x": 0,
        "y": 13,
        "w": 12,
        "h": 6
      },
      "targets": [
        {
          "expr": "sum(rate(dnsbl_queries_total[5m])) by (provider, result)",
          "legendFormat": "{{provider}} - {{result}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "DNSBL Hit Rate",
      "gridPos": {
        "x": 12,
        "y": 13,
        "w": 12,
        "h": 6
      },
      "targets": [
        {
          "expr": "sum(rate(dnsbl_hits_total[5m])) by (provider)",
          "legendFormat": "{{provider}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "DNSBL Latency by Provider",
      "gridPos": {
        "x": 0,
        "y": 19,
        "w": 12,
        "h": 6
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(dnsbl_latency_seconds_bucket[5m])) by (provider, le))",
          "legendFormat": "{{provider}} P95"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      }
    },
    {
      "type": "stat",
      "title": "Fast-Flux Detections",
      "gridPos": {
        "x": 12,
        "y": 19,
        "w": 6,
        "h": 6
      },
      "targets": [
        {
          "expr": "sum(increase(fast_flux_detection_total{detected=\"true\"}[5m]))",
          "legendFormat": "Fast-Flux Detected"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "green"
              },
              {
                "value": 5,
                "color": "yellow"
              },
              {
                "value": 20,
                "color": "red"
              }
            ]
          }
        }
      }
    },
    {
      "type": "stat",
      "title": "DNSSEC Validation Success Rate",
      "gridPos": {
        "x": 18,
        "y": 19,
        "w": 6,
        "h": 6
      },
      "targets": [
        {
          "expr": "sum(rate(dnssec_validation_total{result=\"success\"}[5m])) / sum(rate(dnssec_validation_total[5m])) * 100",
          "legendFormat": "Success Rate"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "red"
              },
              {
                "value": 70,
                "color": "yellow"
              },
              {
                "value": 90,
                "color": "green"
              }
            ]
          }
        }
      }
    },
    {
      "type": "row",
      "title": "Certificate Intelligence",
      "gridPos": {
        "x": 0,
        "y": 25,
        "w": 24,
        "h": 1
      },
      "collapsed": false
    },
    {
      "type": "timeseries",
      "title": "Certificate Analysis Rate",
      "gridPos": {
        "x": 0,
        "y": 26,
        "w": 12,
        "h": 6
      },
      "targets": [
        {
          "expr": "sum(rate(cert_analysis_total[5m])) by (result)",
          "legendFormat": "{{result}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Suspicious Certificate Reasons",
      "gridPos": {
        "x": 12,
        "y": 26,
        "w": 12,
        "h": 6
      },
      "targets": [
        {
          "expr": "sum(rate(cert_suspicious_total[5m])) by (reason)",
          "legendFormat": "{{reason}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      }
    },
    {
      "type": "row",
      "title": "Local Threat Database",
      "gridPos": {
        "x": 0,
        "y": 32,
        "w": 24,
        "h": 1
      },
      "collapsed": false
    },
    {
      "type": "gauge",
      "title": "OpenPhish Feed Entries",
      "gridPos": {
        "x": 0,
        "y": 33,
        "w": 6,
        "h": 6
      },
      "targets": [
        {
          "expr": "threat_feed_entries{source=\"openphish\"}",
          "legendFormat": "Entries"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "red"
              },
              {
                "value": 1000,
                "color": "yellow"
              },
              {
                "value": 5000,
                "color": "green"
              }
            ]
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Threat Feed Updates",
      "gridPos": {
        "x": 6,
        "y": 33,
        "w": 12,
        "h": 6
      },
      "targets": [
        {
          "expr": "sum(rate(threat_feed_update_total[5m])) by (source, result)",
          "legendFormat": "{{source}} - {{result}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Local Threat Hits by Type",
      "gridPos": {
        "x": 18,
        "y": 33,
        "w": 6,
        "h": 6
      },
      "targets": [
        {
          "expr": "sum(rate(local_threat_hits_total[5m])) by (match_type)",
          "legendFormat": "{{match_type}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Collaborative Learning Events",
      "gridPos": {
        "x": 0,
        "y": 39,
        "w": 12,
        "h": 6
      },
      "targets": [
        {
          "expr": "sum(rate(collaborative_learning_total[5m])) by (action)",
          "legendFormat": "{{action}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      }
    },
    {
      "type": "row",
      "title": "HTTP Fingerprinting",
      "gridPos": {
        "x": 0,
        "y": 45,
        "w": 24,
        "h": 1
      },
      "collapsed": false
    },
    {
      "type": "timeseries",
      "title": "HTTP Fingerprint Rate",
      "gridPos": {
        "x": 0,
        "y": 46,
        "w": 12,
        "h": 6
      },
      "targets": [
        {
          "expr": "sum(rate(http_fingerprint_total[5m])) by (result)",
          "legendFormat": "{{result}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Suspicious HTTP Indicators",
      "gridPos": {
        "x": 12,
        "y": 46,
        "w": 12,
        "h": 6
      },
      "targets": [
        {
          "expr": "sum(rate(http_fingerprint_suspicious_total[5m])) by (reason)",
          "legendFormat": "{{reason}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      }
    },
    {
      "type": "row",
      "title": "Advanced Heuristics",
      "gridPos": {
        "x": 0,
        "y": 52,
        "w": 24,
        "h": 1
      },
      "collapsed": false
    },
    {
      "type": "timeseries",
      "title": "Heuristic Detections by Type",
      "gridPos": {
        "x": 0,
        "y": 53,
        "w": 24,
        "h": 6
      },
      "targets": [
        {
          "expr": "sum(rate(heuristic_detection_total[5m])) by (type)",
          "legendFormat": "{{type}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      }
    }
  ]
}
